Karel Wintersky, [27.11.17 18:33]
Скажите пожалуйста, у меня одного вот в этом примере:
https://jsfiddle.net/Arris/s0be0gye/2/
градиент есть не на всех углах? :)

Тимофей Урбанович (motw), [27.11.17 18:35]
[In reply to Karel Wintersky]
[ Photo ]
нет

Тимофей Урбанович (motw), [27.11.17 18:36]
155-291 градус примерно тоже нет градиента, но четверть круга хотя бы правильно рисуется.

огнелис 57.0, убунту 14.04.

Karel Wintersky, [27.11.17 18:36]
Грёбаный радиальный градиент :(

Karel Wintersky, [27.11.17 18:37]
[In reply to Тимофей Урбанович (motw)]
В хроме, что интересно, он тоже не рисуется. Причем примерно на тех же углах.

Андрей Кругликов, [27.11.17 18:37]
[In reply to Karel Wintersky]
276 градусов есть градиент, 273 градуса - нет градиента. Хром в. 62

Max, [27.11.17 18:45]
Вивальди. Градиент не во всех углах. Уверен, дело не в canvas)

Karel Wintersky, [27.11.17 18:50]
Уверен, дело не в алгоритме. Если заменить градиентную заливку сплошным синим цветом:
  ctx.fillStyle = "#0000ff"; // в 51-ой строчке 
всё будет ок :)

Sofia, [27.11.17 19:02]
[In reply to Karel Wintersky]
Но при этом если в 44-45 убрать |0 - начинает работать нормально.

Sofia, [27.11.17 19:02]
А что со сплошной заливкой работает - так не удивительно, для нее градиент-специфичные вычисления не применимы.

Karel Wintersky, [27.11.17 19:03]
[In reply to Sofia]
Такое ощущение, что бага то внутри JS-движка. Если на одних данных показывает, а на других данных нет... я бы понимал.

P.S. Я тоже разучился считать буквы :(

Sofia, [27.11.17 19:04]
Судя по поведению - не показывает на ситуациях, когда gradient_end_xy.x, y равен нулю.

Sofia, [27.11.17 19:04]
Непонятно, правда, почему именно в этих значениях углов они обнуляются.

Sofia, [27.11.17 19:06]
Слушайте, а как в этом вашем js в этом вашем jsfiddle значение в консоль вывести?

Sofia, [27.11.17 19:06]
Мне таки кажется, что проблема в расчетах.

Karel Wintersky, [27.11.17 19:09]
Но тогда была проблема с точностью.

Max, [27.11.17 19:10]
А сейчас ты фигачишь туда целые числа и ждёшь, что проблем с точностью не будет?

Max, [27.11.17 19:10]
{x: 157.949514654756, y: 289.0731128489274} 157 289

Serj Seiche, [27.11.17 19:11]
ненавижу математику и float

Karel Wintersky, [27.11.17 19:11]
[In reply to Max]
var gradient = ctx.createRadialGradient(
                            Number(center.x),
                            Number(center.y),
                            0,
                            Number(gradient_end_xy.x),
                            Number(gradient_end_xy.y),
                            Number(this.options.radius)
                        );
ни на что не влияет :(

Max, [27.11.17 19:12]
Тебе уже сказали - ты сам расчитал эти значения пятью строчками выше, зачем тебе их вообще куда-то приводить? Просто убираешь приведение типов - и всё работает

Sofia, [27.11.17 19:13]
[In reply to Karel Wintersky]
Так не надо их приводить

Sofia, [27.11.17 19:13]
И обнулять тоже

Sofia, [27.11.17 19:13]
var gradient = ctx.createRadialGradient(
    center.x,
    center.y,
    0,
    gradient_end_xy.x,
    gradient_end_xy.y,    
    Rs | 0
  );

Работает ок.

Sofia, [27.11.17 19:14]
Хотя я все еще не понимаю, почему | 0 дает эффект именно на этих значениях  gradient_end_xy.x и gradient_end_xy.y

Sofia, [27.11.17 19:17]
[In reply to Max]
Но при этом 
Ad = 151
(index):96 gradient x = 125.07605857212084
(index):97 gradient y = 396.96192404926745

Отрисовывается нормально. В чем разница при приведении x и y?..

Karel Wintersky, [27.11.17 19:18]
Кажется проще переписать код заново, чем пытаться его починить.

Sofia, [27.11.17 19:18]
Так а чем рабочий вариант конкретно этого примера не устраивает?

Max, [27.11.17 19:23]
Я, кстати, понял, что происходит. Правда, так и не понял, чего именно хотел добиться автор

Sofia, [27.11.17 19:23]
О. А можно объяснение?

Sofia, [27.11.17 19:23]
Я все еще не понимаю, почему округление ломает, и почему таким образом.

Karel Wintersky, [27.11.17 19:25]
[In reply to Sofia]
Потому что он нерабочий :(
https://jsfiddle.net/Arris/8Lz67trd/
у меня при угле 145 белый сектор

Max, [27.11.17 19:25]
createRadialGradient() создаёт градиент между двумя окружностями. Не обязательно с общим центром. И автор (Аррис, если я не путаю) пользуется этой функциональностью, задавая центр второй окружности на границе сектора. Правда, я не понимаю, какое визуальное решение имелось в виду.

Max, [27.11.17 19:26]
Но в результате после приведения к целому методом отбрасывания дробной части центр второй окружности периодически оказывается за границей контура, который предполагалось покрасить.

Karel Wintersky, [27.11.17 19:26]
[In reply to Max]
Именно так. Одна точка градиента - это вершина сектора, другая точка - это точка на границе.

Max, [27.11.17 19:26]
И canvas отказывается рисовать такой градиент.

Karel Wintersky, [27.11.17 19:27]
[In reply to Max]
Воооот оно что.... Ну так мы эту проблему решим костылём. Сделаем -1 где-нибудь %)

Max, [27.11.17 19:28]
Если в строчках 37 и 38 дописать *0.9 - всё работает

Sofia, [27.11.17 19:28]
[In reply to Max]
Круто! Спасибо

Karel Wintersky, [27.11.17 19:28]
Спасибо за анализ.

Max, [27.11.17 19:37]
[In reply to Karel Wintersky]
Спасибо за иллюстративный пример. К сожалению, очень часто, когда я слышу выступления на тему "кривой js, кривые фреймворки, кривые браузеры, кривой canvas", ситуация выглядит примерно так (

Sofia, [27.11.17 19:38]
[In reply to Алексей Ариксу Петров]
Это вряд ли, а вот тесты, походу, придется. Ожидайте в чатике криков про глобальные переменные и прочие детские болезни.

----

Демо: 
https://jsfiddle.net/Arris/d0avxo5z/